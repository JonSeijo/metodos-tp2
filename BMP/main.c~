#include "bmp/bmp.h"
#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>

char* iamgenarchivo = "lalala.bmp";
char* resu = "resultado.txt";

int main(){

	


	BMP* imagen = bmp_read(iamgenarchivo);
	uint32_t* alto = bmp_get_h(imagen);

	uint32_t altoVerdadero = *(alto);

	uint8_t* datos = bmp_get_data(imagen);

	for(int i = 0; i < (int)(altoVerdadero*altoVerdadero*4); i +=4){
		//Recordar la componente de trasparencia
		//Sumo las otras 3 RGB y saco el promedio
		uint8_t suma = datos[i+1] + datos[i+2] + datos[i+3];
		float suma_d = (float)suma;
		suma_d /= 3;
		int sumaF = (int)suma_d;

		FILE *fp;
		fp = fopen(resu, "a+");
		fprintf(fp, "%li", sumaF); 

		if((i/4)%28 == 27){
			fprintf(fp, "%s", "\n");
		}
		else{
			fprintf(fp, "%s", ",");
		}
	}

	FILE *fp;
	fp = fopen(resu, "a+");
	fprintf(fp, "%s\n", "\n"); 

	return 0;
		
}